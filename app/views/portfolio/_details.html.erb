<div class="px-4 py-2">
  <h1>Stock Details</h1>
  <table class="table table-sm table-hover table-striped">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col">Company</th>
        <th scope="col">Ticker</th>
        <th scope="col">Current Price</th>
        <th scope="col">Shares Owned</th>
        <th scope="col">Average Price</th>
        <th scope="col">Gains/Losses</th>
      </tr>
    </thead>
    <tbody>
      <% if @stocks.any? %>
        <% @stocks.uniq(&:ticker).each_with_index do |stock, index| %>
          <% stock_transactions = @transactions.where(stock_id: stock.id) %>
          <% current_share_price = stock.price %>
          <% total_shares = Transaction.total_shares(stock_transactions) %>
          <% avg_price = Transaction.avg_price(stock_transactions) %>
          <tr>
            <th scope="row"><%= index + 1 %></th>
            <td><%= stock.company_name %></td>
            <td><%= stock.ticker %></td>
            <td><%= display_with_decimals(stock.price, 2) %></td>
            <td><%= display_with_decimals(total_shares, 0) %></td>
            <td><%= display_with_decimals(avg_price, 2) %></td>
            <td>
              <%= total_shares * (stock.price - avg_price) %>
            </td>
          </tr>
        <% end %>
      <% else %>
        <tr>
          <td>No stock info to display.</td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>
