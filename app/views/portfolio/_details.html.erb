
<div class="px-4 py-2">
  <h1>Stock Details</h1>
  <table class="table table-sm table-hover table-striped">
        <thead>
            <tr>
                <th scope="col">#</th>
                <th scope="col">Company</th>
                <th scope="col">Ticker</th>
                <th scope="col">Current Price</th>
                <th scope="col">Shares Owned</th>
                <th scope="col">Average Price</th>
                <th scope="col">Gains/Losses</th>
            </tr>
        </thead>
        <tbody>
            <% @stocks.uniq(&:ticker).each_with_index do |stock, index| %>
            <% stock_transactions = @transactions.where(stock_id: stock.id) %>
            <% current_share_price = stock.price %>
            <tr>
                <th scope="row"><%= index + 1 %></th>
                <td><%= stock.company_name %></td>
                <td><%= stock.ticker %></td>
                <td><%= display_with_decimals(stock.price, 2) %></td>
                <td><%= display_with_decimals(Transaction.total_shares(stock_transactions), 0) %></td>
                <td><%= display_with_decimals(Transaction.avg_price(stock_transactions), 2) %></td>
                <td><%= stock_transactions.reduce(0) do |total, transaction|  
                          total + transaction.calc_gains_or_losses(current_share_price)
                          end / stock_transactions.count %>
                          </td>
            </tr>
            <% end %>
        </tbody>
    </table>
</div>
